## 4.6 Gameplay Abilities    Move to Separate file
### 4.6.1 Gameplay Ability Definition
GameplayAbilities 是一个Actor在Game中世纪可以做的任何actions 或者skills.Example::
* Jumping
* Sprinting
* Shooting a gun 
* Passively blocking an attack every X number of seconds
* Using a potion
* Opening a door 
* Collecting a resource 
* Constructing a building 
不应该用GameplayAbilities实现的:
* Baseic Movement input 
* Some interactions with UIs - Don't use a GameplayAbility to purchase an item from a store.


### 4.6.2 Binding Input to the ASC
在通常绑定按键的函数`SetupPlayerInputComponent`调用ASC的下面的函数:
```c++
void UAbilitySystemComponent::BindAbilityActivationToInputComponent(UInputComponent* InputComponent, FGameplayAbilityInputBinds BindInfo)
```
FGameplayAbilityInputBinds中需要传入瞄准和取消瞄准的按键绑定的Name, 这两个特殊处理, 然后是自定义枚举的Name。
例如:
```c++
AbilitySystemComponent->BindAbilityActivationToInputComponent(InputComponent, FGameplayAbilityInputBinds(FString("ConfirmTarget"),
	FString("CancelTarget"), FString("EGDAbilityInputID"), static_cast<int32>(EGDAbilityInputID::Confirm), static_cast<int32>(EGDAbilityInputID::Cancel)));

// 其中 AbilitySystemComponent_Abilities.cpp
void UAbilitySystemComponent::BindAbilityActivationToInputComponent(UInputComponent* InputComponent, FGameplayAbilityInputBinds BindInfo)
{
	UEnum* EnumBinds = BindInfo.GetBindEnum();

	SetBlockAbilityBindingsArray(BindInfo);

	for(int32 idx=0; idx < EnumBinds->NumEnums(); ++idx)
	{
		const FString FullStr = EnumBinds->GetNameStringByIndex(idx);
		
		// Pressed event
		{
			FInputActionBinding AB(FName(*FullStr), IE_Pressed);
			AB.ActionDelegate.GetDelegateForManualSet().BindUObject(this, &UAbilitySystemComponent::AbilityLocalInputPressed, idx);
			InputComponent->AddActionBinding(AB);
		}

		// Released event
		{
			FInputActionBinding AB(FName(*FullStr), IE_Released);
			AB.ActionDelegate.GetDelegateForManualSet().BindUObject(this, &UAbilitySystemComponent::AbilityLocalInputReleased, idx);
			InputComponent->AddActionBinding(AB);
		}
	}

	// Bind Confirm/Cancel. Note: these have to come last!
	if (BindInfo.ConfirmTargetCommand.IsEmpty() == false)
	{
		FInputActionBinding AB(FName(*BindInfo.ConfirmTargetCommand), IE_Pressed);
		AB.ActionDelegate.GetDelegateForManualSet().BindUObject(this, &UAbilitySystemComponent::LocalInputConfirm);
		InputComponent->AddActionBinding(AB);
	}
	
	if (BindInfo.CancelTargetCommand.IsEmpty() == false)
	{
		FInputActionBinding AB(FName(*BindInfo.CancelTargetCommand), IE_Pressed);
		AB.ActionDelegate.GetDelegateForManualSet().BindUObject(this, &UAbilitySystemComponent::LocalInputCancel);
		InputComponent->AddActionBinding(AB);
	}

	if (BindInfo.CancelTargetInputID >= 0)
	{
		GenericCancelInputID = BindInfo.CancelTargetInputID;
	}
	if (BindInfo.ConfirmTargetInputID >= 0)
	{
		GenericConfirmInputID = BindInfo.ConfirmTargetInputID;
	}
}
```
这会将EGDAbilityInputID枚举中的每一个字段的字符串Name作为Action Name, 对应在枚举类中的索引作为参数, 绑定到函数:`void UAbilitySystemComponent::AbilityLocalInputPressed(int32 InputID)`,这个函数会在已被授予的Abilities中寻找所有FGameplayAbilitySpec的InputID和传入ID相同的Ability, 并在没有激活的时候激活它.
```c++
ABILITYLIST_SCOPE_LOCK();
for (FGameplayAbilitySpec& Spec : ActivatableAbilities.Items)
{
	if (Spec.InputID == InputID)
	{
		if (Spec.Ability)
		{
			Spec.InputPressed = true;
			if (Spec.IsActive())
			{
				if (Spec.Ability->bReplicateInputDirectly && IsOwnerActorAuthoritative() == false)
				{
					ServerSetInputPressed(Spec.Handle);
				}
				AbilitySpecInputPressed(Spec);
				// Invoke the InputPressed event. This is not replicated here. If someone is listening, they may replicate the InputPressed event to the server.
				InvokeReplicatedEvent(EAbilityGenericReplicatedEvent::InputPressed, Spec.Handle, Spec.ActivationInfo.GetActivationPredictionKey());					
			}
			else
			{
				// Ability is not active, so try to activate it
				TryActivateAbility(Spec.Handle);
			}
		}
	}
}
```
ActivatableAbilities中的FGameplayAbilitySpec的InputID是通过ASC的`GiveAbility(const FGameplayAbilitySpec& Spec)`添加的.在Give Ability时(或创建FGameplayAbilitySpec时), 应该就想好了要和哪一个按键绑定, 从事先定义的枚举获得, 可以在Ability中定义一个属性`AbilityInputID`, 在蓝图中编辑. 

默认授予的Ability也可以是一个Character的成员数组, 在Character被Possess的时候授予所有Ability.